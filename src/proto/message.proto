syntax = "proto3";

package message;

// 消息类型枚举
enum MessageType {
  TEXT = 0;
  IMAGE = 1;
  FILE = 2;
  SYSTEM = 3;
}

// 消息状态枚举
enum MessageStatus {
  SENDING = 0;
  SENT = 1;
  DELIVERED = 2;
  READ = 3;
  FAILED = 4;
}

// 聊天类型枚举
enum ChatType {
  PRIVATE = 0;
  GROUP = 1;
}

// 用户信息
message User {
  string id = 1;
  string username = 2;
  string avatar_url = 3;
  bool is_online = 4;
  int64 last_seen = 5;
}

// 群组信息
message Group {
  string id = 1;
  string name = 2;
  string avatar_url = 3;
  string description = 4;
  repeated User members = 5;
  User creator = 6;
  int64 created_at = 7;
}

// 聊天会话
message ChatSession {
  string id = 1;
  ChatType type = 2;
  string name = 3;
  string avatar_url = 4;
  repeated User participants = 5;
  Group group_info = 6;
  Message last_message = 7;
  int64 last_activity = 8;
  int32 unread_count = 9;
  bool is_pinned = 10;
  bool is_muted = 11;
}

// 消息内容
message Message {
  string id = 1;
  string chat_id = 2;
  string sender_id = 3;
  User sender = 4;
  MessageType type = 5;
  string content = 6;
  string file_url = 7;
  string file_name = 8;
  int64 file_size = 9;
  MessageStatus status = 10;
  int64 created_at = 11;
  int64 updated_at = 12;
  bool is_deleted = 13;
  repeated string read_by = 14;
  repeated string delivered_to = 15;
}

// 私信请求
message PrivateMessageRequest {
  string receiver_id = 1;
  MessageType type = 2;
  string content = 3;
  string file_url = 4;
  string file_name = 5;
  int64 file_size = 6;
}

// 群组消息请求
message GroupMessageRequest {
  string group_id = 1;
  MessageType type = 2;
  string content = 3;
  string file_url = 4;
  string file_name = 5;
  int64 file_size = 6;
}

// 创建群组请求
message CreateGroupRequest {
  string name = 1;
  string description = 2;
  string avatar_url = 3;
  repeated string member_ids = 4;
}

// 加入群组请求
message JoinGroupRequest {
  string group_id = 1;
}

// 离开群组请求
message LeaveGroupRequest {
  string group_id = 1;
}

// 消息响应
message MessageResponse {
  bool success = 1;
  string message = 2;
  Message data = 3;
}

// 聊天会话列表响应
message ChatSessionsResponse {
  bool success = 1;
  string message = 2;
  repeated ChatSession data = 3;
  int32 total = 4;
  int32 page = 5;
  int32 limit = 6;
}

// 消息历史响应
message MessageHistoryResponse {
  bool success = 1;
  string message = 2;
  repeated Message data = 3;
  int32 total = 4;
  int32 page = 5;
  int32 limit = 6;
}

// 群组列表响应
message GroupsResponse {
  bool success = 1;
  string message = 2;
  repeated Group data = 3;
  int32 total = 4;
  int32 page = 5;
  int32 limit = 6;
}

// 实时消息事件
message MessageEvent {
  enum EventType {
    NEW_MESSAGE = 0;
    MESSAGE_READ = 1;
    USER_TYPING = 2;
    USER_STOPPED_TYPING = 3;
    USER_ONLINE = 4;
    USER_OFFLINE = 5;
    GROUP_CREATED = 6;
    GROUP_UPDATED = 7;
    USER_JOINED_GROUP = 8;
    USER_LEFT_GROUP = 9;
  }
  
  EventType type = 1;
  Message message = 2;
  User user = 3;
  Group group = 4;
  string chat_id = 5;
  int64 timestamp = 6;
}
